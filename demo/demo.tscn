[gd_scene load_steps=5 format=2]

[ext_resource path="res://lightning/lightning.tscn" type="PackedScene" id=1]
[ext_resource path="res://demo/demo.gd" type="Script" id=2]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float radius = 4.0;
uniform float step_size = 1.0;
uniform float sd = 10.0;
uniform float additive_strength = 24.0;
uniform float center_strength = 1.0;

void fragment() {
	float pi = 3.141592653;
	float e = 2.71828;
	float left = 1.0 / (2.0 * pi * pow(sd, 2));
	vec4 sum = vec4(0.0);
	for (float x = -radius; x <= radius; x += step_size) {
		for (float y = -radius; y <= radius; y += step_size) {
			vec4 value = texture(SCREEN_TEXTURE, SCREEN_UV + SCREEN_PIXEL_SIZE * vec2(x, y));
			float p = -(pow(x, 2) + pow(y, 2)) / (2.0 * pow(sd, 2));
			sum += value * left * pow(e, p);
		}
	}
	COLOR = sum * additive_strength + texture(SCREEN_TEXTURE, SCREEN_UV) * center_strength;
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/radius = 4.0
shader_param/step_size = 1.0
shader_param/sd = 10.0
shader_param/additive_strength = 8.0
shader_param/center_strength = 0.7

[node name="Demo" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0
script = ExtResource( 2 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Lightning" parent="." instance=ExtResource( 1 )]
MAX_BRANCH_CHANCE = 0.25

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="ColorRect" type="ColorRect" parent="CanvasLayer"]
material = SubResource( 2 )
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
color = Color( 0, 0, 0, 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="CanvasLayer2" type="CanvasLayer" parent="."]

[node name="GenerateButton" type="Button" parent="CanvasLayer2"]
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
margin_left = -35.5
margin_top = -77.0
margin_right = 35.5
margin_bottom = -57.0
text = "Generate"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="FPSCounter" type="Label" parent="CanvasLayer2"]
margin_left = 1.0
margin_top = 1.0
margin_right = 41.0
margin_bottom = 15.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Settings" type="VBoxContainer" parent="CanvasLayer2"]
anchor_top = 0.5
anchor_bottom = 0.5
margin_left = 1.0
margin_top = -20.0
margin_right = 302.0
margin_bottom = 36.0
alignment = 1

[node name="NStrikes" type="HBoxContainer" parent="CanvasLayer2/Settings"]
margin_right = 301.0
margin_bottom = 16.0

[node name="Title" type="Label" parent="CanvasLayer2/Settings/NStrikes"]
margin_top = 1.0
margin_right = 123.0
margin_bottom = 15.0
text = "Number of strikes: "

[node name="NStrikesSlider" type="HSlider" parent="CanvasLayer2/Settings/NStrikes"]
margin_left = 127.0
margin_right = 227.0
margin_bottom = 16.0
rect_min_size = Vector2( 100, 0 )
min_value = 1.0
max_value = 50.0
value = 1.0
scrollable = false
ticks_on_borders = true

[node name="Number" type="Label" parent="CanvasLayer2/Settings/NStrikes"]
margin_left = 231.0
margin_top = 1.0
margin_right = 247.0
margin_bottom = 15.0
text = "(1)"

[node name="TimeBetweenStrikes" type="HBoxContainer" parent="CanvasLayer2/Settings"]
margin_top = 20.0
margin_right = 301.0
margin_bottom = 36.0

[node name="Title" type="Label" parent="CanvasLayer2/Settings/TimeBetweenStrikes"]
margin_top = 1.0
margin_right = 165.0
margin_bottom = 15.0
text = "Time between strikes (s): "

[node name="TimeSlider" type="HSlider" parent="CanvasLayer2/Settings/TimeBetweenStrikes"]
margin_left = 169.0
margin_right = 269.0
margin_bottom = 16.0
rect_min_size = Vector2( 100, 0 )
min_value = 0.025
max_value = 0.2
step = 0.025
value = 0.1
scrollable = false
ticks_on_borders = true

[node name="Number" type="Label" parent="CanvasLayer2/Settings/TimeBetweenStrikes"]
margin_left = 273.0
margin_top = 1.0
margin_right = 301.0
margin_bottom = 15.0
text = "(0.1)"

[node name="BranchChance" type="HBoxContainer" parent="CanvasLayer2/Settings"]
margin_top = 40.0
margin_right = 301.0
margin_bottom = 56.0

[node name="Title" type="Label" parent="CanvasLayer2/Settings/BranchChance"]
margin_top = 1.0
margin_right = 105.0
margin_bottom = 15.0
text = "Branch chance:  "

[node name="BranchChanceSlider" type="HSlider" parent="CanvasLayer2/Settings/BranchChance"]
margin_left = 109.0
margin_right = 209.0
margin_bottom = 16.0
rect_min_size = Vector2( 100, 0 )
min_value = 0.001
max_value = 0.25
step = 0.001
value = 0.01
scrollable = false
ticks_on_borders = true

[node name="Number" type="Label" parent="CanvasLayer2/Settings/BranchChance"]
margin_left = 213.0
margin_top = 1.0
margin_right = 249.0
margin_bottom = 15.0
text = "(0.01)"

[connection signal="simulation_completed" from="Lightning" to="." method="_on_Lightning_simulation_completed"]
[connection signal="pressed" from="CanvasLayer2/GenerateButton" to="." method="_on_GenerateButton_pressed"]
[connection signal="value_changed" from="CanvasLayer2/Settings/NStrikes/NStrikesSlider" to="." method="_on_NStrikesSlider_value_changed"]
[connection signal="value_changed" from="CanvasLayer2/Settings/TimeBetweenStrikes/TimeSlider" to="." method="_on_TimeBetweenStrikesSlider_value_changed"]
[connection signal="value_changed" from="CanvasLayer2/Settings/BranchChance/BranchChanceSlider" to="." method="_on_BranchChanceSlider_value_changed"]
